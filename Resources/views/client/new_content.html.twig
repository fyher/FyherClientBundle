<link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css"
      integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA=="
      crossorigin=""/>
<script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js"
        integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA=="
        crossorigin=""></script>



<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <div class="row">
                    <div class="col-md-4">
                        {% if client is defined %}
                            <b>Fiche :</b>  {{ client.nomClient |capitalize }} {{ client.prenomClient|capitalize }}&nbsp;&nbsp;
                            {% if client.activeClient==1 %}
                              <a href="{{ url("client_activation_client",{"hashClient":client.hashClient,"statut":0}) }}" class="btn btn-success btn-sm">ACTIF</a>
                            {% else %}
                              <a href="{{ url("client_activation_client",{"hashClient":client.hashClient,"statut":1}) }}" class="btn btn-secondary btn-sm"> INACTIF</a>
                            {% endif %}

                        {% endif %}

                    </div>
                    <div class="col-md-3 offset-md-3" align="right">
                        <a href="{{ referer }}" class="btn btn-dark btn-sm " data-toggle="tooltip" data-placement="top" title="Revenir en arrière"><i class="fa fa-undo"></i> </a>
                        <a href="{{ url("client_client_liste") }}" class="btn btn-info btn-sm" data-toggle="tooltip" data-placement="top" title="Liste des clients"><i class="fa fa-users"></i> </a>
                        <a href="{{ url("client_client_add") }}" class="btn btn-info btn-sm" data-toggle="tooltip" data-placement="top" title="Ajoter un client"><i class="fa fa-plus"></i> </a>
                    </div>
                    <div class="col-md-2" align="right">
                        <a href="#" data-link="{{ url("alarme_add_alarme",{"hashclient":client.hashClient}) }}"  data-nom="Ajouter une alarme pour le client {{ client.nomClient |capitalize }} {{ client.prenomClient | capitalize }}" class="btn btn-sm btn-warning openpopupfyher" data-toggle="tooltip" data-placement="top" title="Ajouter une alarme"><i class="fa fa-bell"></i> </a>
                        <a href="#" data-link="{{ url("notes_add_note",{"hashclient":client.hashClient}) }}" data-nom="Ajouter une note pour le client {{ client.nomClient |capitalize }} {{ client.prenomClient |capitalize}}" class="btn btn-sm btn-warning openpopupfyher" data-toggle="tooltip" data-placement="top" title="Ajouter une note"><i class="fa fa-sticky-note"></i> </a>
                    </div>
                </div>
           </div>
            <div class="card-body">
                {% form_theme form 'bootstrap_4_layout.html.twig' %}

                {{ form_start(form, { 'attr': {'novalidate': 'novalidate',"id":"formnote" } }) }}
                <div class="row">
                    <div class="col-md-4">
                        {{ form_row(form.civiliteClient) }}
                    </div>
                    <div class="col-md-4">
                        {{ form_row(form.nomClient) }}
                    </div>
                    <div class="col-md-4">
                        {{ form_row(form.prenomClient) }}
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4">
                        {{ form_row(form.adresseClient) }}
                    </div>
                    <div class="col-md-4">
                        {{ form_row(form.villeClient) }}
                    </div>
                    <div class="col-md-4">
                        {{ form_row(form.codePostalClient) }}
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-3">
                        {{ form_row(form.departementNomClient) }}
                    </div>
                    <div class="col-md-3">
                        {{ form_row(form.departementCodeClient) }}
                    </div>
                    <div class="col-md-3">
                        {{ form_row(form.paysClient) }}
                    </div>
                    <div class="col-md-3">
                        {{ form_row(form.codeInseeVilleClient) }}
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        {{ form_row(form.numeroFixeClient) }}
                    </div>
                    <div class="col-md-6">
                        {{ form_row(form.numeroMobileClient) }}
                    </div>
                </div>
                {{ form_rest(form) }}


                <input type="submit" value="{% if client  is defined%}Modifier{% else %}Enregistrer{% endif %}" class="btn btn-fw success btn-block button" />
                {{ form_end(form) }}
            </div>
            <div class="card-footer">

            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <b>Source(s)</b>
            </div>
            <div class="card-body">
                {% for l in listesource %}
                        <a href="{{ l.idSource.urlSource }}" target="_blank">{{ l.idSource.urlSource }}</a>  le {{ l.dateCreationSourceClient | date("Y-m-d H:i") }} <br>
                        {% for key,value in l.dataSourceClient %}
                                <b>{{ key  }}</b> => {{ value }}
                            {% endfor %}
                {% endfor %}
            </div>
        </div>
        <br>
        <div class="card">
            <div class="card-header">
                <b>Géolocalisation</b>
            </div>
            <div class="card-body">
                <div id="mapid" style="width: 100%; height: 400px;"></div>
                <script>

                    var mymap = L.map('mapid').setView([{{ client.longitudeClient }}, {{ client.latitudeClient }}], 13);

                    L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={{ tokenMap }}', {
                        maxZoom: 18,
                        attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
                            '<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
                            'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
                        id: 'mapbox.streets'
                    }).addTo(mymap);

                    L.marker([{{ client.longitudeClient }}, {{ client.latitudeClient }}]).addTo(mymap);

                </script>
            </div>
        </div>
    </div>
</div>
<br>
<div class="row">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <b>Liste des actions</b>
            </div>
            <div class="card-body">
                {% for liste in pagination %}
                    <div class="row">
                        <div class="col-md-4">

                            <span class="badge badge-{% if liste.action=="update" %}info{% endif %}{% if liste.action=="delete" %}danger{% endif %}{% if liste.action=="insert" %}success{% endif %}">{{ liste.action | upper }} </span>
                        </div>
                        <div class="col-md-6">
                            {% for key,value in liste.data %}
                                <b>{{ key }}</b> => {{ value }}
                            {% endfor %}
                        </div>
                        <div class="col-md-2">
                            {% if liste.username %}
                             Réalisé par  <b>{{ liste.username |capitalize }}</b> le <i>{{ liste.loggedAt | date("Y-m-d H:i") }}</i>
                            {% endif %}
                        </div>
                    </div>
                    <br>

                {% endfor %}
            </div>
            <div class="card-footer">
                <div class="navigation">
                    {{ knp_pagination_render(pagination,"FyherClientBundle:pagination:pagination.html.twig") }}
                </div>
            </div>
        </div>
    </div>
</div>

